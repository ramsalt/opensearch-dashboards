---
# Default Kibana configuration from kibana-docker.

server.name: {{ getenv "DASHBOARDS_SERVER_NAME" "kibana" }}
server.host: "{{ getenv "DASHBOARDS_SERVER_HOST" "0.0.0.0" }}"

opensearch.hosts: [{{ getenv "DASHBOARDS_OPENSEARCH_HOSTS" "https://opensearch:9200" }}]
opensearch.ssl.verificationMode: none
opensearch.username: kibanaserver
opensearch.password: kibanaserver
opensearch.requestHeadersWhitelist: [authorization, securitytenant]

opensearch_security.multitenancy.enabled: true
opensearch_security.multitenancy.tenants.preferred: [Private, Global]
opensearch_security.readonly_mode.roles: [kibana_read_only]
# Use this setting if you are running opensearch-dashboards without https
opensearch_security.cookie.secure: false

{{ define "OIDC" -}}
opensearch_security.openid.connect_url: "{{ getenv "OIDC_CONNECT_URL" }}"
opensearch_security.openid.client_id: "{{ getenv "OIDC_CLIENT_ID" }}"
opensearch_security.openid.client_secret: "{{ getenv "OIDC_CLIENT_SECRET" }}"
opensearch_security.openid.base_redirect_url: "{{ getenv "DASHBOARDS_ENDPOINT_URL" }}"
{{- end -}}

{{ define "SAML" -}}
server.xsrf.allowlist: ["/_opendistro/_security/saml/acs/idpinitiated", "/_opendistro/_security/saml/acs", "/_opendistro/_security/saml/logout"]
{{- end -}}

{{- if getenv "AUTH_TYPE_OIDC" }}
opensearch_security.auth.type: "oidc"
{{ template "OIDC" }}
{{- end -}}

{{- if getenv "AUTH_TYPE_SAML" }}
opensearch_security.auth.type: "saml"
{{ template "SAML" }}
{{- end }}

{{- if getenv "AUTH_TYPE_OIDC_AND_SAML" }}
{{ template "OIDC" }}
{{ template "SAML" }}
opensearch_security.auth.type: ["oidc", "saml"]
opensearch_security.auth.multiple_auth_enabled: true
{{- end }}
